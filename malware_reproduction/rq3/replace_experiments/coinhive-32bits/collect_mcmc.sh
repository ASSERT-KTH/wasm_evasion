
ORIGINALS="046dc a32a6 fbdd 0d996 d214"

for ORIG in $ORIGINALS
do

    pkill -f server.py
    pkill -f xmrig
    pkill -f stratum
    pkill -f Chrome

    mkdir -p "out_mcmc/$ORIG"

    echo -n $ORIG > binname.txt
    # Launch xmrig
    ../xmrig-proxy -0 http://localhost:3333 &
    XMRIG=$!

    # Launch stratum
    ../stratum/bin/coin-hive-stratum 8892 &
    STRATUMID=$!

    # For each binary and its variants

    # Launch this server
    python3 server.py fbdd1e &
    SERVERID=$!

    # Open chrome pupeeter and get the console log
    python3 puppetercollect.py "out_mcmc/$ORIG/original.logs.txt"

    kill -9 $XMRIG
    kill -9 $STRATUMID
    kill -9 $SERVERID

    pkill -f server.py
    pkill -f xmrig
    pkill -f stratum
    pkill -f Chrome


    # Now test all variants
    for var in $(find mcmc/$ORIG -name "*0.01.wasm.wat.fix.wasm")
    do
        echo $var
        base=$(basename $var)
        echo -n $base > binname.txt
        # Launch xmrig
        ../xmrig-proxy -0 http://localhost:3333 &
        XMRIG=$!

        # Launch stratum
        ../stratum/bin/coin-hive-stratum 8892 &
        STRATUMID=$!

        # For each binary and its variants

        # Launch this server
        echo $base
        python3 server.py $base &
        SERVERID=$!

        # Open chrome pupeeter and get the console log
        python3 puppetercollect.py "out_mcmc/$ORIG/0.01.logs.txt"

        kill -9 $XMRIG
        kill -9 $STRATUMID
        kill -9 $SERVERID
    done

    pkill -f server.py
    pkill -f xmrig
    pkill -f stratum
    pkill -f Chrome
    # Now test all variants
    for var in $(find mcmc/$ORIG -name "*0.3.wasm.wat.fix.wasm")
    do
        echo $var
        base=$(basename $var)
        echo -n $base > binname.txt
        # Launch xmrig
        ../xmrig-proxy -0 http://localhost:3333 &
        XMRIG=$!

        # Launch stratum
        ../stratum/bin/coin-hive-stratum 8892 &
        STRATUMID=$!

        # For each binary and its variants

        # Launch this server
        echo $base
        python3 server.py $base &
        SERVERID=$!

        # Open chrome pupeeter and get the console log
        python3 puppetercollect.py "out_mcmc/$ORIG/0.3.logs.txt"

        kill -9 $XMRIG
        kill -9 $STRATUMID
        kill -9 $SERVERID
    done

    pkill -f server.py
    pkill -f xmrig
    pkill -f stratum
    pkill -f Chrome
    # Now test all variants
    for var in $(find mcmc/$ORIG -name "*1.1.wasm.wat.fix.wasm")
    do
        echo $var
        base=$(basename $var)
        echo -n $base > binname.txt
        # Launch xmrig
        ../xmrig-proxy -0 http://localhost:3333 &
        XMRIG=$!

        # Launch stratum
        ../stratum/bin/coin-hive-stratum 8892 &
        STRATUMID=$!

        # For each binary and its variants

        # Launch this server
        echo $base
        python3 server.py $base &
        SERVERID=$!

        # Open chrome pupeeter and get the console log
        python3 puppetercollect.py "out_mcmc/$ORIG/1.1.logs.txt"

        kill -9 $XMRIG
        kill -9 $STRATUMID
        kill -9 $SERVERID
    done
done
