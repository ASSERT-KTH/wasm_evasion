
ORIGINALS="d214 a32a6f 046dc08 fbdd1e 0d996"

for ORIG in $ORIGINALS
do

    mkdir -p "out/$ORIG"
    echo $ORIG
    echo -n $ORIG > binname.txt
    # Launch xmrig
        # Launch stratum
    ../stratum/bin/coin-hive-stratum 8892 &
    STRATUMID=$!

    # For each binary and its variants
    ../xmrig-proxy -o http://0.0.0.0:3333 --http-port 3333 &
    XMRIG=$!


    # Launch this server
    python3 server.py $ORIG &
    SERVERID=$!

    # Open chrome pupeeter and get the console log
    python3 puppetercollect.py "out/$ORIG/original.logs.txt"

    kill -9 $XMRIG
    kill -9 $STRATUMID
    kill -9 $SERVERID

    # Now test all variants
    for var in $(find variants/$ORIG -name "*.fix.wasm")
    do
        echo $var
        base=$(basename $var)
        echo -n $base > binname.txt
        # Launch xmrig
        ../xmrig-proxy -o http://localhost:3333 --http-port 3333 &
        XMRIG=$!

        # Launch stratum
        ../stratum/bin/coin-hive-stratum 8892 &
        STRATUMID=$!

        # For each binary and its variants

        # Launch this server
        echo $base
        python3 server.py $base &
        SERVERID=$!

        # Open chrome pupeeter and get the console log
        python3 puppetercollect.py "out/$ORIG/$base.logs.txt"

        kill -9 $XMRIG
        kill -9 $STRATUMID
        kill -9 $SERVERID
    done
done
